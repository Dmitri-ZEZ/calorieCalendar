<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CaloriesCalendar</title>

    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script crossorigin="anonymous"
            integrity="sha256-+C0A5Ilqmu4QcSPxrlGpaZxJ04VjsRjKu+G82kl5UJk="
            src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/js/standalone/selectize.min.js"></script>
    <link crossorigin="anonymous"
          href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.bootstrap3.min.css"
          integrity="sha256-ze/OEYGcFbPRmvCnrSeKbRTtjG4vGLHXgOqsyLFTRjg=" rel="stylesheet"/>
</head>
</head>
<body>
<div class="container">
    <nav class="navbar bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#" th:text=" ${appName}"></a>
            <form method="POST" th:action="@{/logout}">
                <input class="btn btn-danger" type="submit" value="Выйти"/>
            </form>
        </div>
    </nav>

    <div class="col text-success"><p th:text="'Всего ' + ${allCalories} + ' калорий'"></p></div>

    <div class="row">
        <div class="col-8">
            <table class="table">
                <thead>
                <tr>

                </tr>
                </thead>
                <tbody>
                <tr>
                    <th scope="row"><h3>Завтрак</h3></th>
                </tr>
                <tr>
                    <th scope="row">
                        <div th:each="meal : ${mealList}">
                            <div th:if="${meal.mealType == T(com.example.calorieCalendar.model.MealType).BREAKFAST}">
                                <div th:each="productAndGramms : ${meal.productAndGrammsList}">
                                    <div class="row">
                                        <div class="col"><p th:text="${productAndGramms.product.title}"></p></div>
                                        <div class="col"><p th:text="${productAndGramms.gramms} + ' грамм'"></p></div>
                                        <div class="col"><p th:text="${productAndGramms.calories} + ' калорий'"></p>
                                        </div>
                                        <div class="col">
                                            <form method="POST" th:action="@{/deleteMeal}" th:object="${mealDto}">
                                                <input name="id" th:value="${meal.id}" type="hidden"/>
                                                <input name="gramms" th:value="${productAndGramms.gramms}"
                                                       type="hidden"/>
                                                <input class="btn btn-danger" type="submit" value="Удалить"/>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col text-success"><p>Всего: </p></div>
                            <div class="col"></div>
                            <div class="col text-success"><p th:text="${breakfastCalories} + ' калорий'"></p></div>
                        </div>

                    </th>
                </tr>
                <tr>
                    <th scope="row"><h3>Обед</h3></th>
                </tr>
                <tr>
                    <th scope="row">
                        <div th:each="meal : ${mealList}">
                            <div th:if="${meal.mealType == T(com.example.calorieCalendar.model.MealType).DINNER}">
                                <div th:each="productAndGramms : ${meal.productAndGrammsList}">
                                    <div class="row">
                                        <div class="col"><p th:text="${productAndGramms.product.title}"></p></div>
                                        <div class="col"><p th:text="${productAndGramms.gramms} + ' грамм'"></p></div>
                                        <div class="col"><p th:text="${productAndGramms.calories} + ' калорий'"></p>
                                        </div>
                                        <div class="col">
                                            <form method="POST" th:action="@{/deleteMeal}" th:object="${mealDto}">
                                                <input name="id" th:value="${meal.id}" type="hidden"/>
                                                <input name="gramms" th:value="${productAndGramms.gramms}"
                                                       type="hidden"/>
                                                <input class="btn btn-danger" type="submit" value="Удалить"/>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col text-success"><p>Всего: </p></div>
                            <div class="col"></div>
                            <div class="col text-success"><p th:text="${dinnerCalories} + ' калорий'"></p></div>
                        </div>

                    </th>
                </tr>
                <tr>
                    <th scope="row"><h3>Ужин</h3></th>
                </tr>
                <tr>
                    <th scope="row">
                        <div th:each="meal : ${mealList}">
                            <div th:if="${meal.mealType == T(com.example.calorieCalendar.model.MealType).SUPPER}">
                                <div th:each="productAndGramms : ${meal.productAndGrammsList}">
                                    <div class="row">
                                        <div class="col"><p th:text="${productAndGramms.product.title}"></p></div>
                                        <div class="col"><p th:text="${productAndGramms.gramms} + ' грамм'"></p></div>
                                        <div class="col"><p th:text="${productAndGramms.calories} + ' калорий'"></p>
                                        </div>
                                        <div class="col">
                                            <form method="POST" th:action="@{/deleteMeal}" th:object="${mealDto}">
                                                <input name="id" th:value="${meal.id}" type="hidden"/>
                                                <input name="gramms" th:value="${productAndGramms.gramms}"
                                                       type="hidden"/>
                                                <input class="btn btn-danger" type="submit" value="Удалить"/>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col text-success"><p>Всего: </p></div>
                            <div class="col"></div>
                            <div class="col text-success"><p th:text="${supperCalories} + ' калорий'"></p></div>
                        </div>

                    </th>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="col-4">
            <form method="POST" th:action="@{/addMeal}" th:object="${mealDto}">
                <label>Продукт:</label>
                <select required th:field="*{productId}">
                    <option th:each="product : ${productList}" th:text="${product.title}"
                            th:value="${product.id}"></option>
                </select>

                <label>Грамм:</label>
                <input class="form-control" th:field="*{gramms}" type="number"/>
                <p class="text-danger"
                   th:errors="*{gramms}"
                   th:if="${#fields.hasErrors('gramms')}"></p>

                <label>Приём пищи:</label>
                <select required th:field="*{mealType}">
                    <option th:value="BREAKFAST">Завтрак</option>
                    <option th:value="DINNER">Обед</option>
                    <option th:value="SUPPER">Ужин</option>
                </select>

                <br>
                <input class="btn btn-primary" type="submit" value="Добавить"/>
            </form>
        </div>
    </div>
</div>


<script crossorigin="anonymous"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    $(document).ready(function () {
        $('select').selectize({
            sortField: 'text'
        });
    });
</script>
</body>
</html>